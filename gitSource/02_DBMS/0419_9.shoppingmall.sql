-- [IV] 쇼핑몰 설계 

--MEMBER TABLE
DROP TABLE MEMBER;
CREATE TABLE MEMBER (
    mID     VARCHAR2(50) PRIMARY KEY,
    mNAME   VARCHAR2(50),
    mADDR   VARCHAR2(300),
    mTEL    VARCHAR2(30),
    mEMAIL  VARCHAR2(50)
);
SELECT * FROM MEMBER;

--PRODUCT TABLE
CREATE TABLE PRODUCT(
    pCODE   VARCHAR2(30) PRIMARY KEY,
    pNAME   VARCHAR2(50),
    pPRICE  NUMBER(10),
    pSTOCK  NUMBER(10)
    );

SELECT * FROM PRODUCT;
DROP TABLE PRODUCT;


--CART TABLE
CREATE SEQUENCE CART_NUM
    NOCACHE
    NOCYCLE;
    
CREATE TABLE CART(
   NUM      NUMBER(4),
   mID      VARCHAR2(50) REFERENCES MEMBER(mID),
   pCODE    VARCHAR2(30) REFERENCES PRODUCT(pCODE),
   QTY      NUMBER(10),
   COST     NUMBER(20)
);
SELECT * FROM CART;
DROP TABLE CART;
--ORDERS TABLE
CREATE SEQUENCE ORDER_NUM
    NOCACHE
    NOCYCLE;

CREATE TABLE ORDERS(
    oNO     VARCHAR2(30) PRIMARY KEY ,
    mID     VARCHAR2(50) REFERENCES MEMBER(mID),
    oADDR   VARCHAR2(300),
    oTEL    VARCHAR2(30),
    oDATE   DATE    DEFAULT SYSDATE);
SELECT * FROM ORDERS;    
DROP TABLE ORDERS;


--ORDERS_DETAIL
CREATE TABLE ORDERS_DETAIL(
    oNO     VARCHAR2(30) REFERENCES ORDERS(oNO),
    pCODE   VARCHAR2(30) REFERENCES PRODUCT(pCODE),
    QTY     NUMBER(10),
    COST    NUMBER(20)
);
DROP TABLE ORDERS_DETAIL;

SELECT * FROM ORDERS_DETAIL;
--------------------INSERT-------------------------
--MEMBER
INSERT INTO MEMBER VALUES ('abc','홍길동','서울 강남구','010-1111-1111','hong@naver.com');
INSERT INTO MEMBER VALUES ('def','전투왕','서울 서대문구','010-2222-2222','jeon@naver.com');
SELECT * FROM MEMBER;

--PRODUCT
--pCODE,PNAME,PPRICE,PSTOCK
INSERT INTO PRODUCT VALUES ('A1','맥주',3000,10);
INSERT INTO PRODUCT VALUES ('B1','땅콩',3500,10);
INSERT INTO PRODUCT VALUES ('A2','소주',2000,10);
INSERT INTO PRODUCT VALUES ('B2','오징어',5000,10);
INSERT INTO PRODUCT VALUES ('C1','기저귀',7000,10);
SELECT * FROM PRODUCT;

--CART 
--ORDERS
--oNO, mID, oADDR, oTEL, oDATE
SELECT * FROM ORDERS;
DELETE FROM ORDERS;
DROP SEQUENCE ORDER_NUM;
DELETE FROM ORDERS;

INSERT INTO ORDERS VALUES ((TO_CHAR(SYSDATE,'RRMMDD')) || TRIM((TO_CHAR(ORDER_NUM.NEXTVAL,'00000'))), 'abc','서울 강남구','010-1111-1111',SYSDATE);
INSERT INTO ORDERS VALUES ((TO_CHAR(SYSDATE,'RRMMDD')) || TRIM((TO_CHAR(ORDER_NUM.NEXTVAL,'00000'))), 'def','서울 서대문구','010-2222-2222',SYSDATE);
INSERT INTO ORDERS VALUES ((TO_CHAR(SYSDATE,'RRMMDD')) || TRIM((TO_CHAR(ORDER_NUM.NEXTVAL,'00000'))), 'abc','경기도 과천','010-3333-3333',SYSDATE);

-- 주문상세 테이블 oNO, pCODE, QTY, COST(수량*단가) 
SELECT * FROM ORDERS_DETAIL;

INSERT INTO ORDERS_DETAIL VALUES ('22041900012','A1',3,3*(SELECT pPRICE FROM PRODUCT WHERE pCODE='A1'));
INSERT INTO ORDERS_DETAIL VALUES ('22041900012','B1',1,1*(SELECT pPRICE FROM PRODUCT WHERE pCODE='B1'));
INSERT INTO ORDERS_DETAIL VALUES ('22041900012','A2',2,2*(SELECT pPRICE FROM PRODUCT WHERE pCODE='A2'));
INSERT INTO ORDERS_DETAIL VALUES ('22041900012','B2',1,1*(SELECT pPRICE FROM PRODUCT WHERE pCODE='B2'));

INSERT INTO ORDERS_DETAIL VALUES ('22041900013','A2',2,2*(SELECT pPRICE FROM PRODUCT WHERE pCODE='A2'));
INSERT INTO ORDERS_DETAIL VALUES ('22041900013','B2',1,1*(SELECT pPRICE FROM PRODUCT WHERE pCODE='B2'));
INSERT INTO ORDERS_DETAIL VALUES ('22041900013','C1',1,1*(SELECT pPRICE FROM PRODUCT WHERE pCODE='C1'));

INSERT INTO ORDERS_DETAIL VALUES ('22041900014','A1',2,2*(SELECT pPRICE FROM PRODUCT WHERE pCODE='A1'));
INSERT INTO ORDERS_DETAIL VALUES ('22041900014','B1',1,1*(SELECT pPRICE FROM PRODUCT WHERE pCODE='B1'));
INSERT INTO ORDERS_DETAIL VALUES ('22041900014','C1',1,1*(SELECT pPRICE FROM PRODUCT WHERE pCODE='C1'));




