<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.lec.ch19.dao.BookDao">
    	<resultMap type="Book" id="BookResult">
    		<result property="bnum" column="bnum"/>
    		<result property="btitle" column="btitle"/>
    		<result property="bwriter" column="bwriter"/>
    		<result property="brdate" column="brdate"/>
    		<result property="bimg1" column="bimg1"/>
    		<result property="bimg2" column="bimg2"/>
    		<result property="binfo" column="binfo"/>
    	</resultMap>
    	<select id="mainList" resultMap="BookResult">
    	SELECT * FROM BOOK ORDER BY BRDATE DESC
    	</select>
    	<select id="bookList" parameterType="Book" resultMap="BookResult">
    	SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT * FROM BOOK ORDER BY BTITLE) A)
        WHERE RN BETWEEN #{startRow} AND #{endRow}}
    	</select>
    	<select id="totCntBook" resultType="int">
    	SELECT COUNT(*) FROM BOOK
    	</select>
    	<select id="getDetailBook" parameterType="int" resultType="Book">
    	SELECT * FROM BOOK WHERE BNUM=#{bnum}
    	</select>
    	<insert id="registerBook" parameterType="Book">
			<if test="bimg1=='' and bimg2!=''">
			INSERT INTO BOOK (BNUM, BTITLE, BWRITER,BRDATE, BIMG2, BINFO)
			VALUES (BOOK_SQ.NEXTVAL, #{btitle}, #{bwriter}, SYSDATE, #{bimg2},#{binfo})
			</if>
			<if test="bimg1!='' and bimg2==''">
			INSERT INTO BOOK (BNUM, BTITLE, BWRITER,BRDATE, BIMG1, BINFO)
			VALUES (BOOK_SQ.NEXTVAL, #{btitle}, #{bwriter}, SYSDATE, #{bimg1},#{binfo})
			</if>
			<if test="bimg1=='' and bimg2==''">
			INSERT INTO BOOK (BNUM, BTITLE, BWRITER,BRDATE, BINFO)
			VALUES (BOOK_SQ.NEXTVAL, #{btitle}, #{bwriter}, SYSDATE,#{binfo})
			</if>
			<if test="bimg1!='' and bimg2!=''">
			INSERT INTO BOOK (BNUM, BTITLE, BWRITER,BRDATE, BIMG1, BIMG2, BINFO)
			VALUES (BOOK_SQ.NEXTVAL, #{btitle}, #{bwriter}, SYSDATE, #{bimg1},#{bimg2},#{binfo})
			</if>
    	</insert>
    	<update id="modifyBook" parameterType="Book">
    	UPDATE BOOK SET BTITLE=#{btitle},
                BWRITER=#{bwriter},
                BIMG1=#{bimg1},
                BIMG2=#{bimg2},
                BINFO=#{binfo}
                WHERE BNUM=#{bnum}
    	</update>
    </mapper>